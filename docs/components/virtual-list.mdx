import { VirtualList } from '@seven-design-ui/components'
import React, { useState, useEffect, useCallback } from 'react'

# VirtualList è™šæ‹Ÿåˆ—è¡¨

è™šæ‹Ÿåˆ—è¡¨ç»„ä»¶ï¼Œç”¨äºå¤§æ•°æ®é‡çš„åˆ—è¡¨æ¸²æŸ“ï¼Œé€šè¿‡åªæ¸²æŸ“å¯è§åŒºåŸŸçš„å†…å®¹æ¥æé«˜æ€§èƒ½ã€‚

## åŸºç¡€ç”¨æ³•

ä½¿ç”¨ `data` æŒ‡å®šæ•°æ®æºï¼Œ`renderItem` æŒ‡å®šæ¸²æŸ“å‡½æ•°ã€‚

```tsx preview
export default function Demo() {
  const [data, setData] = useState([])
  const [loading, setLoading] = useState(true)

  useEffect(() => {
    const loadData = async () => {
      try {
        const response = await fetch('https://randomuser.me/api/?results=20&inc=name,gender,email,nat,picture&noinfo')
        const result = await response.json()
        const formattedData = result.results.map((user, index) => ({
          id: index + 1,
          name: `${user.name.first} ${user.name.last}`,
          email: user.email,
          gender: user.gender,
          country: user.nat,
          avatar: user.picture.thumbnail
        }))
        setData(formattedData)
      } catch (error) {
        console.error('Failed to load data:', error)
      } finally {
        setLoading(false)
      }
    }
    loadData()
  }, [])

  if (loading) {
    return <div style={{ padding: '20px', textAlign: 'center' }}>åŠ è½½ä¸­...</div>
  }

  return (
    <VirtualList
      data={data}
      height={300}
      itemHeight={70}
      itemKey="id"
      gap={8}
      renderItem={(item, index) => (
        <div style={{
          padding: '12px',
          border: '1px solid #e4e7ed',
          borderRadius: '8px',
          backgroundColor: '#fff',
          display: 'flex',
          alignItems: 'center',
          gap: '12px'
        }}>
          <img
            src={item.avatar}
            alt={item.name}
            style={{
              width: '40px',
              height: '40px',
              borderRadius: '50%',
              objectFit: 'cover'
            }}
          />
          <div style={{ flex: 1 }}>
            <div style={{ fontWeight: 'bold', marginBottom: '4px' }}>{item.name}</div>
            <div style={{ color: '#666', fontSize: '14px' }}>
              {item.email} â€¢ {item.country}
            </div>
          </div>
        </div>
      )}
    />
  )
}
```

## ç­‰é«˜æ¨¡å¼

ç­‰é«˜æ¨¡å¼ä¸‹ï¼Œæ‰€æœ‰é¡¹ç›®å…·æœ‰ç›¸åŒçš„é«˜åº¦ï¼Œé€šè¿‡ `itemHeight` æŒ‡å®šé¡¹ç›®é«˜åº¦ã€‚

```tsx preview
export default function Demo() {
  const [data, setData] = useState([])
  const [loading, setLoading] = useState(true)

  useEffect(() => {
    const loadData = async () => {
      try {
        const response = await fetch('https://randomuser.me/api/?results=20&inc=name,gender,email,nat,picture&noinfo')
        const result = await response.json()
        const formattedData = result.results.map((user, index) => ({
          id: index + 1,
          name: `${user.name.first} ${user.name.last}`,
          email: user.email,
          gender: user.gender,
          country: user.nat,
          avatar: user.picture.medium,
          bio: `æ¥è‡ª${user.nat}çš„${user.gender === 'male' ? 'å¼€å‘è€…' : 'è®¾è®¡å¸ˆ'}ï¼Œçƒ­çˆ±æŠ€æœ¯åˆ›æ–°ã€‚`
        }))
        setData(formattedData)
      } catch (error) {
        console.error('Failed to load data:', error)
      } finally {
        setLoading(false)
      }
    }
    loadData()
  }, [])

  if (loading) {
    return <div style={{ padding: '20px', textAlign: 'center' }}>åŠ è½½ä¸­...</div>
  }

  return (
    <VirtualList
      data={data}
      height={400}
      itemHeight={100}
      itemKey="id"
      gap={12}
      renderItem={(item, index) => (
        <div style={{
          padding: '16px',
          border: '1px solid #e4e7ed',
          borderRadius: '12px',
          backgroundColor: '#fff',
          height: '100%',
          display: 'flex',
          alignItems: 'center',
          gap: '16px'
        }}>
          <img
            src={item.avatar}
            alt={item.name}
            style={{
              width: '60px',
              height: '60px',
              borderRadius: '50%',
              objectFit: 'cover',
              border: '2px solid #e4e7ed'
            }}
          />
          <div style={{ flex: 1 }}>
            <h4 style={{ margin: '0 0 8px 0', color: '#333' }}>{item.name}</h4>
            <p style={{ margin: '0 0 8px 0', color: '#666', fontSize: '14px', lineHeight: '1.4' }}>
              {item.bio}
            </p>
            <div style={{ fontSize: '12px', color: '#999' }}>
              ğŸ“§ {item.email} â€¢ ğŸŒ {item.country}
            </div>
          </div>
        </div>
      )}
    />
  )
}
```

## æ»šåŠ¨åŠ è½½æ›´å¤š

é€šè¿‡ `requestMore` å±æ€§å®ç°æ»šåŠ¨åˆ°åº•éƒ¨æ—¶è‡ªåŠ¨åŠ è½½æ›´å¤šæ•°æ®ã€‚

```tsx preview
export default function Demo() {
  const [data, setData] = useState([])
  const [loading, setLoading] = useState(false)
  const fakeDataUrl = 'https://randomuser.me/api/?results=20&inc=name,gender,email,nat,picture&noinfo'

  const loadMoreData = useCallback(async () => {
    setLoading(true)
    try {
      const response = await fetch(fakeDataUrl)
      const result = await response.json()
      const newData = result.results.map((user, index) => ({
        id: data.length + index + 1,
        name: `${user.name.first} ${user.name.last}`,
        email: user.email,
        gender: user.gender,
        country: user.nat,
        avatar: user.picture.thumbnail
      }))
      setData(prev => [...prev, ...newData])
    } catch (error) {
      console.error('Failed to load data:', error)
    } finally {
      setLoading(false)
    }
  }, [data.length])

  useEffect(() => {
    loadMoreData()
  }, [])

  return (
    <VirtualList
      data={data}
      height={400}
      itemHeight={70}
      itemKey="id"
      gap={8}
      requestMore={loadMoreData}
      renderItem={(item, index) => (
        <div style={{
          padding: '12px',
          border: '1px solid #e4e7ed',
          borderRadius: '8px',
          backgroundColor: '#fff',
          display: 'flex',
          alignItems: 'center',
          gap: '12px'
        }}>
          <img
            src={item.avatar}
            alt={item.name}
            style={{
              width: '40px',
              height: '40px',
              borderRadius: '50%',
              objectFit: 'cover'
            }}
          />
          <div style={{ flex: 1 }}>
            <div style={{ fontWeight: 'bold', marginBottom: '4px' }}>{item.name}</div>
            <div style={{ color: '#666', fontSize: '14px' }}>
              {item.email} â€¢ {item.country}
            </div>
          </div>
        </div>
      )}
    />
  )
}
```

## è‡ªå®šä¹‰æ ·å¼

é€šè¿‡ `className` å’Œå†…è”æ ·å¼è‡ªå®šä¹‰è™šæ‹Ÿåˆ—è¡¨çš„å¤–è§‚ã€‚

```tsx preview
export default function Demo() {
  const [data, setData] = useState([])
  const [loading, setLoading] = useState(true)

  useEffect(() => {
    const loadData = async () => {
      try {
        const response = await fetch('https://randomuser.me/api/?results=20&inc=name,gender,email,nat,picture&noinfo')
        const result = await response.json()
        const formattedData = result.results.map((user, index) => ({
          id: index + 1,
          name: `${user.name.first} ${user.name.last}`,
          email: user.email,
          gender: user.gender,
          country: user.nat,
          avatar: user.picture.thumbnail,
          status: ['æ´»è·ƒ', 'åœ¨çº¿', 'ç¦»çº¿'][index % 3],
          level: Math.floor(Math.random() * 100) + 1
        }))
        setData(formattedData)
      } catch (error) {
        console.error('Failed to load data:', error)
      } finally {
        setLoading(false)
      }
    }
    loadData()
  }, [])

  const getStatusColor = (status) => {
    switch (status) {
      case 'æ´»è·ƒ': return '#67c23a'
      case 'åœ¨çº¿': return '#e6a23c'
      case 'ç¦»çº¿': return '#909399'
      default: return '#909399'
    }
  }

  const getStatusIcon = (status) => {
    switch (status) {
      case 'æ´»è·ƒ': return 'ğŸŸ¢'
      case 'åœ¨çº¿': return 'ğŸŸ¡'
      case 'ç¦»çº¿': return 'âšª'
      default: return 'âšª'
    }
  }

  if (loading) {
    return <div style={{ padding: '20px', textAlign: 'center' }}>åŠ è½½ä¸­...</div>
  }

  return (
    <VirtualList
      data={data}
      height={400}
      itemHeight={120}
      itemKey="id"
      gap={8}
      className="custom-virtual-list"
      renderItem={(item, index) => (
        <div style={{
          padding: '16px',
          border: '2px solid #e4e7ed',
          borderRadius: '12px',
          backgroundColor: '#fafbfc',
          display: 'flex',
          alignItems: 'center',
          gap: '16px',
          boxShadow: '0 2px 8px rgba(0,0,0,0.05)',
          transition: 'all 0.3s ease',
          ':hover': {
            boxShadow: '0 4px 16px rgba(0,0,0,0.1)',
            borderColor: getStatusColor(item.status)
          }
        }}>
          <div style={{ position: 'relative' }}>
            <img
              src={item.avatar}
              alt={item.name}
              style={{
                width: '50px',
                height: '50px',
                borderRadius: '50%',
                objectFit: 'cover',
                border: `3px solid ${getStatusColor(item.status)}`
              }}
            />
            <div style={{
              position: 'absolute',
              bottom: '-5px',
              right: '-5px',
              backgroundColor: '#fff',
              borderRadius: '50%',
              width: '20px',
              height: '20px',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              fontSize: '12px'
            }}>
              {getStatusIcon(item.status)}
            </div>
          </div>
          <div style={{ flex: 1 }}>
            <div style={{ fontWeight: 'bold', marginBottom: '4px', color: '#333' }}>{item.name}</div>
            <div style={{ fontSize: '14px', color: '#666', marginBottom: '8px' }}>
              ğŸ“§ {item.email} â€¢ ğŸŒ {item.country}
            </div>
            <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
              <span style={{
                fontSize: '12px',
                color: getStatusColor(item.status),
                fontWeight: 'bold'
              }}>
                {item.status}
              </span>
              <div style={{
                flex: 1,
                height: '6px',
                backgroundColor: '#e4e7ed',
                borderRadius: '3px',
                overflow: 'hidden'
              }}>
                <div style={{
                  width: `${item.level}%`,
                  height: '100%',
                  backgroundColor: getStatusColor(item.status),
                  transition: 'width 0.3s ease'
                }} />
              </div>
              <span style={{
                fontSize: '12px',
                color: '#666',
                fontWeight: 'bold'
              }}>
                Lv.{item.level}
              </span>
            </div>
          </div>
        </div>
      )}
    />
  )
}
```

## API å‚è€ƒ

### VirtualListProps

| å±æ€§ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| data | `T[]` | - | æ•°æ®æºæ•°ç»„ |
| height | `number \| string` | - | åˆ—è¡¨é«˜åº¦ |
| itemHeight | `number` | 50 | å­é¡¹é«˜åº¦ |
| renderItem | `(item: T, index: number) => ReactNode` | - | å­é¡¹æ¸²æŸ“å‡½æ•° |
| requestMore | `() => Promise<void>` | - | å¼‚æ­¥åŠ è½½æ•°æ®çš„æ–¹æ³• |
| itemKey | `keyof T` | - | ä½œä¸ºå­é¡¹keyçš„å€¼åœ¨itemä¸­å¯¹åº”çš„å±æ€§å­—æ®µ |
| gap | `number` | 0 | å­é¡¹é—´éš” |
| onScroll | `(event: UIEvent<HTMLDivElement>) => void` | - | æ»šåŠ¨äº‹ä»¶ |
| className | `string` | - | è‡ªå®šä¹‰ç±»å |
| children | `ReactNode` | - | å­å…ƒç´  |

## æ³¨æ„äº‹é¡¹

1. è¯·åœ¨ä½¿ç”¨æ—¶ä¼ å…¥ `itemKey`ï¼Œè¿™å¯¹åº”ä½ ä¼ å…¥çš„ `data` ä¸­å•é¡¹çš„ä¸€ä¸ªå±æ€§ï¼Œä¿è¯å®ƒæ˜¯å”¯ä¸€çš„ã€‚
2. æˆ–è€…é€‰æ‹©åœ¨ `renderItem` è¿”å›çš„å…ƒç´ ä¸­æ‰‹åŠ¨ä¼ å…¥ `key` å€¼ï¼Œä¸æ¨èä½¿ç”¨ `index` ä½œä¸º `key`ã€‚
3. æ»šåŠ¨åŠ è½½åŠŸèƒ½éœ€è¦é…åˆ `requestMore` å±æ€§ä½¿ç”¨ï¼Œå½“ç”¨æˆ·æ»šåŠ¨åˆ°åˆ—è¡¨åº•éƒ¨æ—¶ä¼šè‡ªåŠ¨è§¦å‘åŠ è½½æ›´å¤šæ•°æ®ã€‚