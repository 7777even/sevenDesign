import { Upload, Button } from '@seven-design-ui/components'
import React from 'react'

# Upload 上传

通过点击或者拖拽上传文件。

## 基础用法

通过 slot 你可以传入自定义的上传按钮类型和文字提示。 可通过设置 limit 和 on-exceed 来限制上传文件的个数和定义超出限制时的行为。 可通过设置 before-remove 来阻止文件移除操作。

```tsx preview
export default function Demo() {
  return (
    <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
      <Upload
        action="https://httpbin.org/post"
        onSuccess={(response, file) => {
          console.log('上传成功:', response, file);
        }}
        onError={(error, file) => {
          console.log('上传失败:', error, file);
        }}
      >
        <Button type="primary">点击上传</Button>
      </Upload>
    </div>
  )
}
```

## 覆盖前一个文件

设置 limit 和 on-exceed 可以在选中时自动替换上一个文件。

```tsx preview
export default function Demo() {
  return (
    <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
      <Upload
        action="https://httpbin.org/post"
        limit={1}
        onExceed={(files, uploadFiles) => {
          console.log('超出限制的文件:', files);
        }}
        onSuccess={(response, file) => {
          console.log('上传成功:', response, file);
        }}
        onError={(error, file) => {
          console.log('上传失败:', error, file);
        }}
      >
        <Button type="primary">最多上传1个文件</Button>
      </Upload>
    </div>
  )
}
```

## 用户头像

在 before-upload 钩子中限制用户上传文件的格式和大小。

```tsx preview
export default function Demo() {
  return (
    <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
      <Upload
        action="https://httpbin.org/post"
        accept="image/*"
        maxSize={1024 * 1024} // 1MB
        beforeUpload={(file) => {
          const isImage = file.type.startsWith('image/');
          if (!isImage) {
            alert('只能上传图片文件');
            return false;
          }
          const isLt1M = file.size < 1024 * 1024;
          if (!isLt1M) {
            alert('图片大小不能超过1MB');
            return false;
          }
          return true;
        }}
        onSuccess={(response, file) => {
          console.log('上传成功:', response, file);
        }}
        onError={(error, file) => {
          console.log('上传失败:', error, file);
        }}
      >
        <Button type="primary">上传头像</Button>
      </Upload>
    </div>
  )
}
```

## 拖拽上传

你可以将文件拖拽到特定区域以进行上传。

```tsx preview
export default function Demo() {
  return (
    <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
      <Upload
        action="https://httpbin.org/post"
        drag
        multiple
        onSuccess={(response, file) => {
          console.log('上传成功:', response, file);
        }}
        onError={(error, file) => {
          console.log('上传失败:', error, file);
        }}
      />
    </div>
  )
}
```

## 其他补充功能

### 文件预览

点击文件名可以预览文件（目前只支持日志输出，可根据需要扩展）。

### 文件移除

可以通过点击删除按钮移除文件，也可以通过 before-remove 钩子阻止移除操作。

```tsx preview
export default function Demo() {
  return (
    <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
      <Upload
        action="https://httpbin.org/post"
        beforeRemove={(file, fileList) => {
          return confirm(`确定要删除文件 ${file.name} 吗？`);
        }}
        onSuccess={(response, file) => {
          console.log('上传成功:', response, file);
        }}
        onError={(error, file) => {
          console.log('上传失败:', error, file);
        }}
        onRemove={(file, fileList) => {
          console.log('文件已移除:', file, fileList);
        }}
      >
        <Button type="primary">上传文件（可移除）</Button>
      </Upload>
    </div>
  )
}
```

## API

### Props

| 属性 | 说明 | 类型 | 默认值 |
| --- | --- | --- | --- |
| action | 上传的地址 | `string` | - |
| headers | 上传时附带的请求头部 | `Record<string, string>` | - |
| name | 上传的文件字段名 | `string` | `file` |
| data | 上传时附带的额外参数 | `Record<string, any>` | - |
| accept | 接受上传的文件类型 | `string` | - |
| multiple | 是否支持多选文件 | `boolean` | `false` |
| disabled | 是否禁用 | `boolean` | `false` |
| showFileList | 是否显示文件列表 | `boolean` | `true` |
| fileList | 文件列表 | `UploadFile[]` | - |
| drag | 是否支持拖拽上传 | `boolean` | `false` |
| limit | 最大允许上传个数 | `number` | - |
| maxSize | 文件大小限制，单位字节 | `number` | - |
| className | 自定义类名 | `string` | - |
| children | 子元素，用于自定义上传区域 | `ReactNode` | - |
| beforeUpload | 上传文件之前的钩子 | `(file: File, fileList: UploadFile[]) => boolean \| Promise<boolean> \| File` | - |
| beforeRemove | 文件移除之前的钩子 | `(file: UploadFile, fileList: UploadFile[]) => boolean \| Promise<boolean>` | - |
| onExceed | 超出限制时的回调 | `(files: File[], uploadFiles: UploadFile[]) => void` | - |
| onChange | 文件状态改变时的回调 | `(file: UploadFile, fileList: UploadFile[]) => void` | - |
| onSuccess | 文件上传成功的回调 | `(response: any, file: UploadFile, fileList: UploadFile[]) => void` | - |
| onError | 文件上传失败的回调 | `(error: any, file: UploadFile, fileList: UploadFile[]) => void` | - |
| onRemove | 文件移除的回调 | `(file: UploadFile, fileList: UploadFile[]) => void` | - |
| onPreview | 点击文件列表中已上传的文件时的回调 | `(file: UploadFile) => void` | - |

### Events

| 事件名 | 说明 | 类型 |
| --- | --- | --- |
| onChange | 文件状态改变时触发 | `(file: UploadFile, fileList: UploadFile[]) => void` |
| onSuccess | 文件上传成功时触发 | `(response: any, file: UploadFile, fileList: UploadFile[]) => void` |
| onError | 文件上传失败时触发 | `(error: any, file: UploadFile, fileList: UploadFile[]) => void` |
| onRemove | 文件移除时触发 | `(file: UploadFile, fileList: UploadFile[]) => void` |
| onPreview | 点击文件预览时触发 | `(file: UploadFile) => void` |
| onExceed | 超出文件限制时触发 | `(files: File[], uploadFiles: UploadFile[]) => void` |

### UploadFile

| 属性 | 说明 | 类型 | 默认值 |
| --- | --- | --- | --- |
| uid | 文件唯一标识 | `string` | - |
| name | 文件名 | `string` | - |
| size | 文件大小 | `number` | - |
| type | 文件类型 | `string` | - |
| status | 上传状态 | `'ready' \| 'uploading' \| 'success' \| 'error'` | `ready` |
| percent | 上传进度百分比 | `number` | - |
| raw | 原始File对象 | `File` | - |
| url | 上传成功后的URL | `string` | - |
| error | 错误信息 | `string` | - |
| lastModified | 最后修改时间 | `number` | - |